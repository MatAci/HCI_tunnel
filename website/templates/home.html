{% extends "base.html" %}

{% block content %}
<h2>Staza za prolazak mišem</h2>
<p>Pomaknite kursor unutar staze i dođite to cilja</p>

  <svg width="600" height="400" style="border: 1px solid black;">
  <path d="M100,200 Q300,50 500,200" stroke="blue" fill="none" id="upperLine" />
  <path d="M100,300 Q300,350 500,300" stroke="green" fill="none" id="lowerLine" />
  <path id="startLine" stroke="red" d="M 100 200 L 100 300"></path>
  <path id="stopLine" stroke="red" d="M 500 200 L 500 300"></path>
  </svg>

  <!--svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 975.364 346.585" style="border: 1px solid rgb(137, 217, 223);"-->
  <!--svg width="975" height="346" style="border: 1px solid black;">
    <path id="startLine" stroke="red" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" d="M 38.634 204.367 L 38.634 280.515"></path>
    <path id="stopLine" stroke="red" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" d="M 923.292 22.956 L 923.292 101.344"></path>
    <path id="upperLine" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0); fill-opacity: 0;" d="M 38.416 203.715 C 39.054 204.352 47.853 196.517 48.495 195.876 C 53.56 190.81 66.737 190.836 75.931 190.836 C 85.755 190.836 93.159 190.88 101.687 188.037 C 104.805 186.997 109.055 188.504 112.325 188.037 C 122.809 186.539 134.141 187.477 144.801 187.477 C 157.177 187.477 173.34 189.728 183.435 182.998 C 185.564 181.579 184.328 176.995 185.115 175.159 C 187.839 168.802 188.239 162.308 190.714 156.121 C 192.991 150.43 198.02 146.497 199.673 139.884 C 200.692 135.808 202.946 132.304 204.152 128.685 C 210.342 110.117 209.602 93.743 229.348 82.772 C 234.481 79.92 243.507 74.987 250.065 77.173 C 267.841 83.098 269.62 106.337 272.462 121.966 C 274.21 131.579 277.471 150.613 274.142 160.601 C 271.637 168.115 271.466 180.445 275.262 188.037 C 279.682 196.878 288.14 206.514 294.859 213.233 C 295.525 213.9 298.98 213.004 299.898 213.233 C 304.468 214.376 308.528 214.353 313.336 214.353 C 318.863 214.353 323.075 213.826 328.454 212.673 C 335.253 211.216 343.345 208.255 347.491 202.035 C 350.147 198.051 348.398 190.992 349.171 186.357 C 350.13 180.602 352.907 174.333 355.89 169.559 C 360.348 162.427 371.554 156.253 378.847 152.202 C 379.195 152.009 385.092 151.05 385.566 151.642 C 388.87 155.773 394.27 158.478 397.324 162.84 C 406.528 175.989 412.168 190.098 421.96 203.155 C 423.467 205.164 427.246 206.495 429.239 207.634 C 439.871 213.709 447.105 217.041 459.475 219.952 C 464.98 221.248 474.187 222.26 479.072 224.432 C 482.057 225.758 485.86 227.845 488.591 224.432 C 493.777 217.949 493.767 208.626 495.87 200.915 C 502.812 175.461 498.554 150.988 490.83 125.886 C 485.696 109.199 470.327 82.328 494.19 74.373 C 497.641 73.223 501.878 73.279 505.388 72.694 C 509.914 71.939 514.142 71.148 518.826 71.574 C 522.651 71.921 527.452 76.615 530.585 78.853 C 554.911 96.228 543.399 123.888 548.502 149.402 C 550.147 157.627 554.358 164.53 559.141 170.679 C 560.15 171.977 560.082 174.874 561.94 175.719 C 565.272 177.233 568.236 177.303 570.899 179.078 C 573.652 180.913 578.801 176.552 581.537 176.279 C 592.852 175.147 605.113 164.094 612.333 155.562 C 613.517 154.162 613.653 151.755 615.132 150.522 C 632.013 136.455 629.896 106.298 626.331 86.692 C 625.84 83.993 626.63 80.31 625.771 77.733 C 624.418 73.675 621.236 58.414 624.091 53.656 C 630.851 42.389 645.328 29.29 659.926 32.939 C 664.249 34.02 666.836 40.86 668.885 44.138 C 672.947 50.637 673.043 54.293 674.484 61.495 C 675.851 68.333 679.764 74.619 680.643 81.652 C 681.397 87.684 685.639 92.193 687.922 97.33 C 696.313 116.211 703.212 136.181 707.519 155.562 C 711.6 173.923 697.65 200.005 712.558 214.913 C 713.766 216.121 722.609 214.875 723.757 214.353 C 733.269 210.029 740.773 199.115 745.593 190.276 C 747.417 186.933 746.178 184.042 747.273 180.758 C 754.014 160.534 752.872 134.941 752.872 113.008 C 752.872 104.33 750.814 87.63 757.352 81.092 C 761.191 77.253 764.247 72.046 769.67 69.334 C 774.902 66.718 782.264 65.417 786.468 62.615 C 788.902 60.992 799.056 62.868 801.585 62.615 C 807.562 62.017 816.389 59.692 821.742 57.016 C 828.952 53.411 836.859 44.699 842.459 39.098 C 846.007 35.551 852.995 33.042 855.338 30.7 C 855.896 30.141 861.208 30.7 862.057 30.7 C 867.851 30.7 876.836 33.911 881.654 30.7 C 884.756 28.632 890.466 29.629 893.972 28.46 C 900.576 26.259 906.373 24.219 912.449 21.181 C 914.751 20.03 922.528 21.511 922.528 22.861"></path>
    <path id="lowerLine" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0); fill-opacity: 0;" d="M 36.176 281.544 C 38.108 282.509 44.896 282.93 47.374 282.103 C 48.296 281.796 51.374 278.824 52.974 280.424 C 56.264 283.714 57.971 279.388 59.693 275.944 C 60.195 274.94 64.264 274.173 65.292 273.145 C 74.04 264.397 85.727 260.058 94.408 253.548 C 103.17 246.976 115.83 263.163 120.724 266.426 C 123.881 268.53 130.266 264.552 133.042 263.626 C 137.384 262.179 142.499 259.972 147.04 259.147 C 148.722 258.841 151.536 259.626 153.199 258.587 C 160.113 254.266 170.515 246.697 175.036 240.669 C 178.863 235.567 175.947 224.64 180.635 219.952 C 183.144 217.444 188.694 210.894 190.154 206.514 C 191.371 202.864 195.012 200.546 197.433 197.556 C 204.287 189.089 212.28 181.029 219.829 173.479 C 222.929 170.38 228.4 162.325 229.908 157.802 C 230.06 157.345 229.908 151.642 229.908 151.642 C 229.908 151.642 232.031 156.114 232.708 157.242 C 236.354 163.319 236.482 168.295 241.106 172.919 C 241.528 173.341 240.879 175.825 241.106 176.279 C 243.622 181.31 242.298 187.097 244.466 192.516 C 250.45 207.477 250.997 225.361 257.344 241.229 C 259.701 247.122 260.663 254.647 267.423 258.027 C 270.623 259.627 275.659 258.701 279.181 259.707 C 293.173 263.705 312.216 262.133 323.414 254.667 C 328.582 251.222 338.255 251.025 343.012 246.269 C 349.58 239.701 359.103 227.654 368.768 224.432 C 391.35 216.904 394.082 245.868 409.082 251.868 C 420.494 256.433 435.974 254.667 448.276 254.667 C 465.214 254.667 485.759 262.144 504.828 255.787 C 510.097 254.031 522.095 247.569 524.425 242.909 C 528.283 235.193 523.113 223.328 526.105 214.353 C 529.496 204.18 528.905 192.408 528.905 181.318 C 528.905 171.842 529.658 161.839 527.225 153.322 C 526.728 151.585 525.165 141.384 522.186 144.363 C 520.136 146.413 524.193 149.922 524.425 151.082 C 525.49 156.405 532.598 162.389 535.624 168.44 C 539.399 175.992 540.576 185.667 545.142 192.516 C 548.385 197.381 545.15 204.847 548.502 209.874 C 551.89 214.957 556.644 221.678 559.14 226.672 C 559.288 226.967 562.68 226.587 563.06 226.672 C 566.53 227.443 572.932 227.968 575.938 229.471 C 580.196 231.6 584.457 223.978 588.816 221.072 C 591.45 219.316 591.903 213.041 594.975 210.994 C 603.458 205.338 605.044 193.921 613.452 189.717 C 616.525 188.181 618.478 184.138 619.611 182.438 C 620.007 181.844 622.893 179.56 623.531 180.198 C 630.544 187.211 633.698 196.681 640.888 201.475 C 644.784 204.072 649.47 206.823 653.207 209.314 C 654.248 210.008 656.555 208.749 657.686 209.314 C 660.606 210.774 673.488 211.139 677.283 209.874 C 678.306 209.533 683.613 208.366 684.562 209.314 C 687.906 212.658 686.429 225.549 685.122 229.471 C 681.638 239.921 677.379 260.034 690.161 266.426 C 693.938 268.314 699.881 267.157 704.159 267.546 C 715.193 268.549 724.435 267.41 734.955 265.306 C 745.313 263.234 761.553 257.884 767.43 249.068 C 768.993 246.724 771.29 243.588 772.469 241.229 C 772.869 240.431 772.367 237.412 773.029 236.75 C 794.134 215.645 796.765 180.491 807.184 154.442 C 809.625 148.34 808.485 136.532 812.223 130.925 C 815.987 125.28 821.127 116.17 825.102 110.208 C 826.124 108.674 826.606 110.62 827.901 109.649 C 832.981 105.838 837.031 100.105 841.899 96.21 C 846.081 92.865 850.702 90.565 853.657 86.132 C 854.755 84.486 858.223 83.074 858.697 81.653 C 859.657 78.77 865.291 66.317 868.215 64.855 C 872.861 62.532 879.16 62.615 882.773 62.615 C 883.344 62.615 888.198 62.266 888.372 62.615 C 890.409 66.688 898.618 78.46 902.37 82.212 C 904.165 84.007 903.616 87.315 905.73 88.372 C 906.678 88.846 905.735 94.258 906.29 95.091 C 908.295 98.099 907.385 103.465 909.649 105.729 C 911.068 107.148 920.848 101.42 920.848 99.01"></path>
  </svg-->

<!-- Status poruke -->
<!--p id="status" class="mt-3">Kursor je izvan staze.</p-->
{% endblock %}
{% block extra_css %}
<style>
    #status {
        text-align: center;
        font-weight: bold;
        color: #007bff;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    const svg = document.querySelector("svg");
    const upperLine = document.getElementById("upperLine");
    const lowerLine = document.getElementById("lowerLine");

    const startLine = document.getElementById("startLine");
    const startData = startLine.getAttribute("d");
    const stopLine = document.getElementById("stopLine");
    const stopData = stopLine.getAttribute("d");

    const coordinatesStart = startData.split(' ');
    const coordinatesStop= stopData.split(' ');

    const startLineX = parseFloat(coordinatesStart[1]);
    const startLineY1 = parseFloat(coordinatesStart[2]);
    const startLineY2 = parseFloat(coordinatesStart[5]);

    const stopLineX = parseFloat(coordinatesStop[1]);
    const stopLineY1 = parseFloat(coordinatesStop[2]);
    const stopLineY2 = parseFloat(coordinatesStop[5]);
    
    const lineTolerance = 5; // Tolerancija za X koordinatu (ako je miš unutar 5px oko linije)
  
    let passedStart = false; // Praćenje da li je start linija pređena
    let passedStop = false; // Praćenje da li je stop linija pređena
    let lastMouseX = -1; // Početna vrijednost za pohranu prethodne X pozicije miša
    let lastMouseXStop = -1; // Početna vrijednost za pohranu prethodne X pozicije miša za stop liniju
  
    svg.addEventListener("mousemove", (event) => {
      // Dobivanje pozicije miša u SVG koordinatama
      const svgRect = svg.getBoundingClientRect();
      const mouseX = event.clientX - svgRect.left;
      const mouseY = event.clientY - svgRect.top;
  
  
      // Provjera je li miš prešao start liniju (miš mora biti unutar tolerancije oko X = 100 i između Y koordinata 200 i 300)
      if (mouseX >= startLineX - lineTolerance && mouseX <= startLineX + lineTolerance && mouseY >= startLineY1 && mouseY <= startLineY2 && !passedStart) {
        // Provjeravamo je li miš prešao liniju s lijeva na desno
        if (lastMouseX !== -1 && mouseX > lastMouseX) {
          passedStart = true;
          console.log("Start linija pređena s lijeva na desno!");
        }
      }
  
      // Ako nije prešao start liniju, ništa se ne prati
      if (!passedStart) {
        console.log("Čekam da miš prijeđe start liniju...");
        lastMouseX = mouseX; // Pohrani trenutnu poziciju miša za sljedeću provjeru
        return; // Ignoriraj sve dok miš ne pređe start
      }
  
      // Provjera je li miš prešao stop liniju (miš mora biti unutar tolerancije oko X = 500 i između Y koordinata 200 i 300)
      if (mouseX >= stopLineX - lineTolerance && mouseX <= stopLineX + lineTolerance && mouseY >= stopLineY1 && mouseY <= stopLineY2 && !passedStop) {
        // Provjeravamo je li miš prešao liniju s lijeva na desno
        if (lastMouseXStop !== -1 && mouseX > lastMouseXStop) {
          passedStop = true;
          console.log("Stop linija pređena s lijeva na desno!");
        }
      }
  
      // Ako je prešao stop liniju, prestajemo s ispisivanjem pozicije miša
      if (passedStop) {
        console.log("Zaustavljeno praćenje, stop linija pređena.");
        return; // Ne prikazuj ništa nakon stop linije
      }
  
      // Ako nije prešao stop liniju, pratimo gdje je miš u odnosu na linije
      if (passedStart) {
        const upperPoint = getClosestPoint(upperLine, mouseX);
        const lowerPoint = getClosestPoint(lowerLine, mouseX);
  
        // Provjera položaja miša u odnosu na linije
        if (upperPoint && lowerPoint) {
          if (mouseY < upperPoint.y) {
            console.log("Miš je iznad gornje linije.");
          } else if (mouseY > lowerPoint.y) {
            console.log("Miš je ispod donje linije.");
          } else {
            console.log("Miš je između linija.");
          }
        }
      }
  
      // Pohrani trenutnu poziciju miša za sljedeću provjeru
      lastMouseX = mouseX;
      lastMouseXStop = mouseX;
    });
  
    // Funkcija za pronalaženje najbliže točke na liniji
    function getClosestPoint(path, x) {
      const pathLength = path.getTotalLength();
      for (let i = 0; i <= pathLength; i += 5) {
        const point = path.getPointAtLength(i);
        if (Math.abs(point.x - x) < 2) {
          return point;
        }
      }
      return null;
    }
  </script>

  
{% endblock %}